<!--extends file called base.html-->
{% extends "base.html" %}

<!--head of web page-->
{% block head %}

<head>
  <link rel="stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css">
  <!--<script src="static/functions.js"></script>-->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Asap:ital,wght@1,700&display=swap" rel="stylesheet">
</head>

<!--end of head-->
{% endblock %}

<!--body of web page-->
{% block body %}

<h2 id="trendingTitle"> TRENDING IN THE USA </h2>

<div class="container-fluid">

  <!--comment out everything but mainRow to space things out-->

  <div id="mainRow" class="row">

  </div>

<script>

  var element = document.getElementsByClassName("row");
  element.innerHTML = '';

</script>

<!--loop through articles; choose whether to display them & how to display them-->
{% for article in articles %}

<!--check if user wants to filter by each category-->
{% set rightFilterActive = rightFilter %}

<script>console.log("Right filter active: " + "{{rightFilterActive}}")</script>

{% set leftFilterActive = leftFilter %}

<script>console.log("Left filter active: " + "{{rightFilterActive}}")</script>

{% set neutralFilterActive = neutralFilter %}

<script>console.log("Neutral filter active: " + "{{rightFilterActive}}")</script>


{% set imgURL = article['photo_url'] %}
{% set articleName = article['title'] %}
{% set articleAuthor = article['author'] %}
{% set articleContent = article['content'] %}
{% set articleURL = article['url'] %}
{% set articlePoliticalAssignment = article['politicalAssignment'] %}
{% set articleOnSpectrum = article['onSpectrum'] %}

<!-- CODE TO ASSIGN ARTICLE WITH IMAGE BASED ON ITS MACHINE LEARNING ASSIGNMENT-->
<!-- MAKE THIS CODE MORE EFFICIENT WITH PYTHON FUNCTIONS LATER -->
<!-- IN YOUR codeForLater.html RIGHT NOW -->

<!--randomy shuffle articles later-->
<!-- displaying republican / neutral articles if filters allow it -->
<!-- MAKE THIS CODE MORE EFFICIENT WITH FUNCTIONS LATER -->

{% if rightFilterActive == "True" %}

  <script>console.log("political assignment: {{articlePoliticalAssignment}}")</script>
  <script>console.log("articleOnSpectrum: {{articleOnSpectrum}}")</script>

  {% if (articlePoliticalAssignment == 'rep' and articleOnSpectrum != "neutral") or (articlePoliticalAssignment == 'rep' and neutralFilter == "True" and articleOnSpectrum == "neutral") %}

      <!--source: https://stackoverflow.com/questions/2061439/string-concatenation-in-jinja-->
      {% set spectrumImagePath = 'static/spectrumIcons/' ~ articleOnSpectrum ~ '.png' %}

      {% if imgURL is not none and imgURL != "" %}

      <script>

      /* creates code for specific card and store it in array using javascript function */
      /* pass in spectrumImagePath as a parameter  */
      function getCardCode(imageURL, newsArticleURL, newsArticleName, spectrumImagePath) {

        let cardCode = "<div class='col-lg-3 mb-3'>" +
                          "<div class='card h-100'>" +

                            "<img class='card-img-top' src='url' >" +

                            "<div class='card-body'>" +

                            "<div class='tooltip-wrap'>" +
                            "<h5 class='card-title'>" +
                            "<a href='linkToArticle'>nameOfArticle</a></h5>" +
                            "<div class='tooltip-content'>" +
                              "<img class='spectrumImage' src='path' alt='spectrum' />" +
                            "</div>" +
                          "</div>" +

                            "</div>" +

                            "</div>"  +

                          "</div>" +
                        "</div>"

        /* change variable names to something more informative */
        let cardParameter1 = cardCode.replace("url", imageURL);
        let cardParameter2 = cardParameter1.replace("linkToArticle", newsArticleURL);
        let cardParameter3 = cardParameter2.replace("nameOfArticle", newsArticleName);
        let cardParameter4 = cardParameter3.replace("path", spectrumImagePath);

        return cardParameter4;

      }

      var card = getCardCode("{{imgURL}}", "{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
      var element = document.getElementById("mainRow");
      /*console.log(element);*/
      element.innerHTML += "<br>";
      element.innerHTML += card;
      console.log(element.innerHTML);
      console.log(card);

      </script>

      {% else %}

      {% set noImageArticles = true %}
      <!-- add card to the More in US Headlines card-->
      <!--source: https://stackoverflow.com/questions/44830188/uncaught-typeerror-cannot-read-property-append-of-null-in-jquery-->
      <!--source: https://www.tutorialrepublic.com/faq/how-to-add-li-in-an-existing-ul-using-jquery.php-->

      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

      <script>
        $(document).ready(function(){
          $("#list").append('<li class="list-group-item"><a href="{{articleURL}}">{{articleName}}</a></li>');
        });
      </script>

      {% endif %}

    {% endif %}

{% endif %}

<!-- displaying democratic / neutral articles if filters allow it -->

{% if leftFilterActive == "True" %}

  {% if (articlePoliticalAssignment == 'dem' and articleOnSpectrum != "neutral") or (articlePoliticalAssignment == 'dem' and neutralFilter == "True" and articleOnSpectrum == "neutral") %}

      <!--source: https://stackoverflow.com/questions/2061439/string-concatenation-in-jinja-->
      {% set spectrumImagePath = 'static/spectrumIcons/' ~ articleOnSpectrum ~ '.png' %}

      {% if imgURL is not none and imgURL != "" %}

      <script>

      /* creates code for specific card and store it in array using javascript function */
      /* pass in spectrumImagePath as a parameter  */
      function getCardCode(imageURL, newsArticleURL, newsArticleName, spectrumImagePath) {

        let cardCode = "<div class='col-lg-3 mb-3'>" +
                          "<div class='card h-100'>" +

                            "<img class='card-img-top' src='url' >" +

                            "<div class='card-body'>" +

                            "<div class='tooltip-wrap'>" +
                            "<h5 class='card-title'>" +
                            "<a href='linkToArticle'>nameOfArticle</a></h5>" +
                            "<div class='tooltip-content'>" +
                              "<img class='spectrumImage' src='path' alt='spectrum' />" +
                            "</div>" +
                          "</div>" +

                            "</div>" +

                            "</div>"  +

                          "</div>" +
                        "</div>"

        /* change variable names to something more informative */
        let cardParameter1 = cardCode.replace("url", imageURL);
        let cardParameter2 = cardParameter1.replace("linkToArticle", newsArticleURL);
        let cardParameter3 = cardParameter2.replace("nameOfArticle", newsArticleName);
        let cardParameter4 = cardParameter3.replace("path", spectrumImagePath);

        return cardParameter4;

      }

      var card = getCardCode("{{imgURL}}", "{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
      var element = document.getElementById("mainRow");
      /*console.log(element);*/
      element.innerHTML += "<br>";
      element.innerHTML += card;
      console.log(element.innerHTML);
      console.log(card);

      </script>

      {% else %}

      {% set noImageArticles = "True" %}
      <!-- add card to the More in US Headlines card-->
      <!--source: https://stackoverflow.com/questions/44830188/uncaught-typeerror-cannot-read-property-append-of-null-in-jquery-->
      <!--source: https://www.tutorialrepublic.com/faq/how-to-add-li-in-an-existing-ul-using-jquery.php-->

      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

      <script>
        $(document).ready(function(){
          $("#list").append('<li class="list-group-item"><a href="{{articleURL}}">{{articleName}}</a></li>');
        });
      </script>

      {% endif %}

    {% endif %}

  {% endif %}

{% endfor %}


<!-- make sure this is actually working! -->
{% if noImageArticles == "True" %}

<script>

/*card with headlines that don't have images*/
let otherArticles = "<div class='col-lg-3 mb-3'>" +
                      "<div class='card h-100'>" +
                      "<div class='card-header'>" +
                        "More from US Headlines" +
                      "</div>" +
                      "<ul id='list' class='list-group list-group-flush'>" +
                      "</ul>" +
                    "</div>" +
                    "</div" +
                    "<br><br>"

var element = document.getElementById("mainRow");
element.innerHTML += "<br>";
element.innerHTML += otherArticles;

</script>

{% endif %}



<!--end of body-->
{% endblock %}
