<!--extends file called base.html-->
{% extends "base.html" %}

<!--head of web page-->
{% block head %}

<head>
  <link rel="stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Asap:ital,wght@1,700&display=swap" rel="stylesheet">
</head>

<!--end of head-->
{% endblock %}

<!--body of web page-->
{% block body %}
<!--linking to JavaScript file-->
<!--source: https://stackoverflow.com/questions/14711552/external-javascript-file-is-not-getting-added-when-running-on-flask-->


  <!-- nav bar when screen is phone-sized -->

  <div class="smallNav">

  <nav class="navbar navbar-expand-md mb-4">

  <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>-->

  <div id="dropdownLeft" class="dropdown">
  <div class="float-left">
    <button class="dropbtn">
      <img class="siteLogo" src="static/logo3.png" width="65" height="60" alt="logo">
    </button>
  </div>
    <div id="logoDropdown" class="dropdown-content">
      <a id="topHeadlinesLink" class="nav-link" href="/">Top Headlines</a>
      <a class="nav-link" href="/entertainment">Entertainment</a>
      <a class="nav-link" href="/sports">Sports</a>
      <a class="nav-link" href="/business">Business</a>
      <a class="nav-link" href="/science">Science</a>
      <a class="nav-link" href="/health">Health</a>
    </div>
  </div>

  <div class="dropdown" style="float:right;">
  <div class="float-right">
    <button class="dropbtn">
      <img class="filterIcon" src="static/filterIcon.png" width="65" height="60" alt="logo">
    </button>
  </div>
    <div class="dropdown-content">
      <form class="filterCheckboxes" method="post">
      <p>Filter by:</p>
      <p>Right-leaning <input type="checkbox" class="right-leaning" name="party" value="Right"></p>
      <p>Left-leaning <input type="checkbox" class="left-leaning" name="party" value="Left"></p>
      <p>Neutral <input type="checkbox" class="neutral" name="party" value="Neutral"></p>
      <p><input type="submit" value="Submit"></p>
      </form>
    </div>
</div>

</nav>

</div>

  <!-- regular navigation bar -->

  <div class="regularNav">

  <nav class="navbar navbar-expand-md mb-4">

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="/">
    <img class="siteLogo" src="static/logo3.png" width="65" height="60" alt="logo">
  </a>

  <div class="collapse navbar-collapse" id="navbarCollapse">
    <ul class="navbar-nav mr-auto">

      <li class="nav-item">
        <a id="entertainmentNav" class="nav-link" href="/entertainment">Entertainment</a>
      </li>

      <li class="nav-item">
        <a id="sportsNav" class="nav-link" href="/sports">Sports</a>
      </li>

      <li class="nav-item">
        <a id="businessNav" class="nav-link" href="/business">Business</a>
      </li>

      <li class="nav-item">
        <a id="scienceNav" class="nav-link" href="/science">Science</a>
      </li>

      <li class="nav-item">
        <a id="healthNav" class="nav-link" href="/health">Health</a>
      </li>

      <!--<li class="nav-item">
        <a id="worldNav" class="nav-link" href="/mldemo">Machine Learning Demo</a>
      </li>-->

    </ul>

    <div class="dropdown" style="float:right;">
    <div class="float-right">
      <button class="dropbtn">
        <img class="filterIcon" src="static/filterIcon.png" width="65" height="60" alt="logo">
      </button>
    </div>
      <div class="dropdown-content">
        <form class="filterCheckboxes" method="post">
        <p>Filter by:</p>
        <p>Right-leaning <input type="checkbox" class="right-leaning" name="party" value="Right"></p>
        <p>Left-leaning <input type="checkbox" class="left-leaning" name="party" value="Left"></p>
        <p>Neutral <input type="checkbox" class="neutral" name="party" value="Neutral"></p>
        <p><input type="submit" value="Submit"></p>
        </form>
      </div>
  </div>

    </div>
  </nav>
</div>

<div class="container-fluid">

  <div id="mainRow" class="row"></div>

</div>

<!--clear div with class row on page load-->
<script type="text/javascript"
        src="{{ url_for('static', filename='functions.js') }}"></script>

<!--clear form input upon refresh of page-->
<!--source: https://stackoverflow.com/questions/6320113/how-to-prevent-form-resubmission-when-page-is-refreshed-f5-ctrlr/45656609#45656609?newreg=05334529cc45440ba4d26fd23c671889-->
<script type="text/javascript">
    if ( window.history.replaceState ) {
        window.history.replaceState( null, null, window.location.href );
    }
</script>
<script type="text/javascript">

  var element = document.getElementsByClassName("row");
  element.innerHTML = '';

</script>

<!-- if there is an active search query -->
{% if clearMainRow == 'True' %}

  <script>

  console.log("cleared mainRow div")

  /*document.getElementById("list").innerHTML = "";
  console.log(str(document.getElementById("list").innerHTML));*/

  /*$(document).ready(function(){

    $("#list").empty();
    console.log("emptied list");
    console.log("list inner HTML" + str(document.getElementById("list")))

  });*/

  </script>

  {% if printEmptySearch == 'True' %}

    <script> clearBox('mainRow', true) </script>

  {% else %}

    <script> clearBox('mainRow', false) </script>

    {% for article in searchResults %}

      <!--getting properties of article-->
      {% set articleName = article['title'] %}
      {% set articleURL = article['url'] %}
      {% set imgURL = article['imageURL'] %}
      {% set articlePoliticalAssignment = article['leaning'] %}
      {% set articleOnSpectrum = article['onSpectrum'] %}

      {% if articlePoliticalAssignment != 'n/a' %}

          <!--source: https://stackoverflow.com/questions/2061439/string-concatenation-in-jinja-->
          {% set spectrumImagePath = 'static/spectrumIcons/' ~ articleOnSpectrum ~ '.png' %}

          {% if imgURL is not none and imgURL != "blank" %}

          <script type="text/javascript">

          console.log("image url: " + "{{imgURL}}")
          var card = getCardCode("{{imgURL}}", "{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
          var element = document.getElementById("mainRow");
          element.innerHTML += "<br>";
          element.innerHTML += card;

          </script>

          {% else %}

          <script>console.log("article with no image!")</script>

          <!-- add card to the More in US Headlines card-->
          <!--source: https://stackoverflow.com/questions/44830188/uncaught-typeerror-cannot-read-property-append-of-null-in-jquery-->
          <!--source: https://www.tutorialrepublic.com/faq/how-to-add-li-in-an-existing-ul-using-jquery.php-->

          <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
          <script type="text/javascript">

          appendNoImageArticle("{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
          changeArticlesWithImages();
          console.log("articles with images: " + articlesWithImages);

          </script>

          {% endif %}

      {% endif %}

    {% endfor %}

    <script>

    otherArticlesCard = createNoImageCard("More from US Headlines")
    var element = document.getElementById("mainRow");
    element.innerHTML += "<br>";
    element.innerHTML += otherArticlesCard;

    console.log("before deleting card, articles with images: " + getArticlesWithImages())

    if (getArticlesWithImages() == "all") {
      document.getElementById('noImageCard').remove();
    }

    </script>

  {% endif %}

<!-- if no search query is active -->

{% else %}

<!--loop through articles; choose whether to display them & how to display them-->
{% for article in articles %}

<!--check if user wants to filter by each category-->
{% set rightFilterActive = arrayBools[0] %}

<!--<script>console.log("Right filter active: " + "{{rightFilterActive}}")</script>-->

{% set leftFilterActive = arrayBools[1] %}

<!--<script>console.log("Left filter active: " + "{{leftFilterActive}}")</script>-->

{% set neutralFilterActive = arrayBools[2] %}

<!--<script>console.log("Neutral filter active: " + "{{neutralFilterActive}}")</script>-->

<!--getting properties of article-->
{% set articleName = article['title'] %}
{% set articleURL = article['url'] %}
{% set imgURL = article['imageURL'] %}
{% set articlePoliticalAssignment = article['leaning'] %}
{% set articleOnSpectrum = article['onSpectrum'] %}

<script>console.log("article political assignment: {{articlePoliticalAssignment}}")</script>


{% if articlePoliticalAssignment != 'n/a' %}

<!-- displaying republican / neutral articles if filters allow it -->
{% if rightFilterActive == 'True' %}

<!--<script>console.log("Right filter is active");</script>

<script>console.log("political assignment: {{articlePoliticalAssignment}}");</script>

<script>console.log("on spectrum: {{articleOnSpectrum}}");</script>-->

  {% if (articlePoliticalAssignment == 'right' and articleOnSpectrum != "neutral") or (articlePoliticalAssignment == 'right' and neutralFilter == "True" and articleOnSpectrum == "neutral") %}

      <!--source: https://stackoverflow.com/questions/2061439/string-concatenation-in-jinja-->
      {% set spectrumImagePath = 'static/spectrumIcons/' ~ articleOnSpectrum ~ '.png' %}

      {% if imgURL is not none and imgURL != "blank" %}

      <script type="text/javascript">

      var card = getCardCode("{{imgURL}}", "{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
      var element = document.getElementById("mainRow");
      element.innerHTML += "<br>";
      element.innerHTML += card;

      </script>

      {% else %}

      <!-- add card to the More in US Headlines card-->
      <!--source: https://stackoverflow.com/questions/44830188/uncaught-typeerror-cannot-read-property-append-of-null-in-jquery-->
      <!--source: https://www.tutorialrepublic.com/faq/how-to-add-li-in-an-existing-ul-using-jquery.php-->

      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
      <script type="text/javascript">

      appendNoImageArticle("{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
      changeArticlesWithImages();
      console.log("articles with images: " + articlesWithImages);

      </script>


      {% endif %}

    {% endif %}

{% endif %}

<!-- displaying democratic / neutral articles if filters allow it -->

{% if leftFilterActive == 'True' %}

  {% if (articlePoliticalAssignment == 'left' and articleOnSpectrum != "neutral") or (articlePoliticalAssignment == 'left' and neutralFilter == "True" and articleOnSpectrum == "neutral") %}

      <!--source: https://stackoverflow.com/questions/2061439/string-concatenation-in-jinja-->
      {% set spectrumImagePath = 'static/spectrumIcons/' ~ articleOnSpectrum ~ '.png' %}

      {% if imgURL is not none and imgURL != "blank" %}

      <script type="text/javascript">

      var card = getCardCode("{{imgURL}}", "{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
      var element = document.getElementById("mainRow");
      element.innerHTML += "<br>";
      element.innerHTML += card;

      </script>

      {% else %}

      <script>console.log("article with no image!")</script>

      <!-- add card to the More in US Headlines card-->
      <!--source: https://stackoverflow.com/questions/44830188/uncaught-typeerror-cannot-read-property-append-of-null-in-jquery-->
      <!--source: https://www.tutorialrepublic.com/faq/how-to-add-li-in-an-existing-ul-using-jquery.php-->

      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
      <script type="text/javascript">

      appendNoImageArticle("{{articleURL}}", "{{articleName}}", "{{spectrumImagePath}}")
      changeArticlesWithImages();
      console.log("articles with images: " + articlesWithImages);

      </script>

      {% endif %}

    {% endif %}

  {% endif %}

  <!--end of if statement checking if article has been classified-->
  {% endif %}

{% endfor %}

<script>

otherArticlesCard = createNoImageCard("More from US Headlines")
var element = document.getElementById("mainRow");
element.innerHTML += "<br>";
element.innerHTML += otherArticlesCard;

console.log("before deleting card, articles with images: " + getArticlesWithImages())

if (getArticlesWithImages() == "all") {
  document.getElementById('noImageCard').remove();
}

/* refresh database and check if this is necessary in app.py */
databaseRefresh()

/* source: https://tecadmin.net/get-current-date-time-javascript/

var today = new Date();
var minute = today.getMinutes();

if(minute == "58") {
  databaseRefresh()
} else {
  console.log("we haven't reached a new hour yet!")
}*/

</script>

{% endif %}

<!--end of body-->
{% endblock %}
